<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6f4e37">
    <title>Espresso Tracker - Version Compl√®te</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; padding: 20px; padding-bottom: 80px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #2c3e50; margin-bottom: 20px; font-size: 28px; }
        h2 { color: #2c3e50; margin-bottom: 15px; font-size: 20px; }
        h3 { color: #2c3e50; margin-bottom: 10px; font-size: 18px; }
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 2px solid #ddd; overflow-x: auto; }
        .tab { padding: 12px 16px; background: none; border: none; cursor: pointer; font-size: 15px; color: #666; border-bottom: 3px solid transparent; transition: all 0.2s; white-space: nowrap; }
        .tab.active { color: #6f4e37; border-bottom-color: #6f4e37; font-weight: 600; }
        .card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #555; font-weight: 500; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #6f4e37; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #6f4e37; color: white; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-small { padding: 6px 12px; font-size: 14px; }
        .btn-danger { background: #dc3545; color: white; }
        .shot-list, .bag-list { display: flex; flex-direction: column; gap: 15px; }
        .shot-card, .bag-card { background: #fafafa; border: 2px solid #e0e0e0; border-radius: 8px; padding: 15px; }
        .shot-header, .bag-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .shot-title, .bag-title { font-weight: 600; color: #2c3e50; font-size: 16px; }
        .shot-date { font-size: 14px; color: #888; }
        .shot-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; font-size: 14px; }
        .detail { color: #666; }
        .detail strong { color: #333; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, #6f4e37 0%, #5a3d2a 100%); color: white; padding: 15px; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 32px; font-weight: 700; margin-bottom: 5px; }
        .stat-label { font-size: 14px; opacity: 0.9; }
        .chart-container { position: relative; height: 300px; margin-top: 20px; }
        .alert { padding: 12px; border-radius: 8px; margin-bottom: 15px; }
        .alert-info { background: #e3f2fd; color: #1976d2; border-left: 4px solid #1976d2; }
        .alert-success { background: #e8f5e9; color: #388e3c; border-left: 4px solid #388e3c; }
        .alert-error { background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
        .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .bag-status { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; margin-top: 8px; }
        .bag-status.active { background: #4caf50; color: white; }
        .bag-status.finished { background: #9e9e9e; color: white; }
        .file-input-wrapper { position: relative; display: inline-block; }
        .file-input-wrapper input[type=file] { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
        @media (max-width: 600px) {
            .two-col { grid-template-columns: 1fr; }
            body { padding: 10px; }
        }
    </style>
</head>
<body>
    <div id="root"><div class="container"><div class="loading"><h1>‚òï Chargement...</h1></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <script>
        window.addEventListener('load', function() {
            if (typeof window.supabase === 'undefined') {
                document.getElementById('root').innerHTML = '<div class="container"><div class="card"><div class="alert alert-error">‚ùå Supabase error</div></div></div>';
                return;
            }
            
            const { useState, useEffect, useRef } = React;
            const { createClient } = window.supabase;

            const SUPABASE_URL = 'https://duzxzqmjkovrsfwhdyml.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1enh6cW1qa292cnNmd2hkeW1sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NjAzMzYsImV4cCI6MjA4NjMzNjMzNn0.hRUDEbr9yhd_R1Q0lLVYYppnht5tUAd5TtE9kanzvos';

            const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            const LOGOS = {
                timana: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACbUlEQVR4nO2bPVLDMBSEVxnOkQ5OQUtDTkBNmYaOM9DRUKbmBlSUnIKSjlOYgiiRZcnSk/WzzmgbMkNG8n5vnyx7IoW6GgTfVcWuouIkEsMhFbnWEoN6TQ/vN9GDqIfv2X8Lrmd+nlwDwWFcYjgkD5DF158DQFHjtnKDWArgZL6kaZ8sGEleUgGMqt7CvJYjESJPKQDOVd8f/j/cviQMk1epadgI55maB4CvZ+Ew+WWlMPr2KwHgNk+kFAixAMLmCVIAyCHEAIiv/AohhADQx96nWAhzANLMk6QAiIMQbIG1Vd5WaI/iAzAAC8wTpQAYQZikwAUgzyMsGQRDI3/eFlh79G35WsEGsCz6tshS4GoF6Vb44mQCyPn66iyyFBgaAEcCLq33bdlrQZ0W4E3B6bk57+LnE8F7Ay39/qAvglVnI2yFngDU6n8tkhTou0FPQJNZSVIAtEwACYTeAk1nJ0jBVesL2P1+Npx921ugKYDd9V3L6QE0BMBgHmi9CBJog+MjsXp7rDYpQ/U/nrYAegLqA2CovqmegOPfKusAS/V1/wNQ1RLAYt7WBEDNu0ELGdUHMAZQ7HfDpNVXQF8EJwCyL4ZM1TcXP/3Bm4BLWwvs3tdyAci2FjBV39DIny8Bi1uBybwr+lrBRXDtreCLvtYcgBMtKQSW6lvmna0dSkAyhNaKMQ/E7QNEEBiqH2seiN8IRUFYm3lAthOkbwepeUC+FfZCaF39FPOiL1oanxnaH5oBcNzmRJ5SH4YUCFrCUXVxQYucG7x//ckwrFuejU2zc4OmioLIbTzbAA55f3EqARLYwlKeHXaJ/vT4H4+IseLBtt/JAAAAAElFTkSuQmCC',
                gedeo: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACcUlEQVR4nO2bvU7DMBSFTyo2dgZmNhaeAYmZHfYO3XkKdiTYeQDmCt6CjZWFvXNY6shx7NjX8c9J5bNQidbO+e65jhMlHcqqF3y3y3YUBSeRGPYpy7HmGNRp+vb9EDzI1+P53L+THXdKABPjEsM+OYAsPv4UALIaN5UaxFIAg/mcpl0yYER5iQUwqnoN80qWRIg8xQAYzG/3OwDAz99zxDBpFZuGjXCeiXkAuLp4Eg6TXkYKg0+/EgBW80yKgRAKwGueIQWAHEIIgODKrxGCDwB97F0KhTAHIMo8SwqAMAjeFlhb5U359iguAD0Qb54pBcAIwiQFNgBJLmHZIGga+XO2wNqjb8rVCiaARdE3xZYCWytIt8InJx1AyttXg9hSoKkHLAk4td43Za4FRVqAOAXDdXPSxc8lhvsGSur+QVsES07G2AotASjU/0osKVBng5aAGpOypAComAAWCK0Fak7OkIKz2gfwefNQbe4OrQXqAni9/K05PYCKABjMA60FsMHxkvjt7qXYpAzV764/ALQElAfAUH1dLQHHv0XWAZbqq/4H0BVLAIt5UxMAJc8GNaRVH8AYQLbnhkmr3wFtEZwASL4YMlVfX/zUB2cCTm0tMHtfyQYg2VrAVH1NI3+uBCxuBSbztugreRfBtbeCK/pKcwAGWlIILNU3zFtb25eAaAi1FWIeCNsHiCAwVD/UPBC+EQqCsDbzgGwnSN8OUvOAfCvshFC7+jHmRV80NHqibLvfVQNgOc1lf2dI1wCi/75fOJRcsVVf/CNDk+cLc8JwbGyqvTeoKyuI1MaTDWCR84lTCRDPFpby3WGb6N8e/wdHGbWdc2XBIwAAAABJRU5ErkJggg==',
                generic: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACdUlEQVR4nO2bP07DMBjFXypuwYbETTgDExIDOwsLW8XWhYWdoRITZ0Bi4QLMSEyUiTuEpY4cx679Of7zUvktVKK1837f+xwnSjqUVS/4bpftKApOIjHsU5ZjzTGo0/Tb60vwIBeXV4f+ney4UwKYGJcY9skBZPbxpwCQ1bip1CDmAhjM5zTtkgEjykssgFHVa5hXsiRC5CkGwGB+u1kDAE7PziOGSavYNKyE80zMA8Du+0s4THoZKQw+/UoAWM0zKQZCKACveYYUAHIIIQCCK79ECD4A9LF3KRTCIQBR5llSAIRB8LbA0ipvyrdHcQHogXjzTCkARhAmKbABSHIJywZB08ifswWWHn1TrlYwAcyKvim2FNhaQboVPjrpAFLevhrElgJNPWBJwLH1vilzLSjSAsQpGK6bky5+LjHcN1BS9w/aIlhyMsZWaAlAof5XYkmBOhu0BNSYlCUFQMUEsEBoLVBzcoYUnNQ+gM+P96rztxaoOfnf70/N6QFUBMBgHmgtgBX2l8TX9w/FJmWo/t3TM4CWgPIAGKqvqyVg/7fIOsBSfdX/ALpiCWAxb2oCoOTZoIa06gMYA8j23DBp9TugLYITAMkXQ6bq64uf+uBMwLGtBWbvK9kAJFsLmKqvaeTPlYDZrcBk3hZ9Je8iuPRWcEVf6RCAgZYUAkv1DfPW1vYlIBpCbYWYB8L2ASIIDNUPNQ+Eb4SCICzNPCDbCdK3g9Q8IN8KOyHUrn6MedEXDY2eKNtu1tUAWE5z2d8Z0jWAeLy9mTmUXLFVn/0jQ5PnC3PCcGxsqr03qCsriNTGkw1gkfOJUwkQzxaW8t1hm+jfHv8HiQrra/56lPwAAAAASUVORK5CYII='
            };

            function getLogo(name) {
                if (!name) return LOGOS.generic;
                const n = name.toLowerCase();
                if (n.includes('timana') || n.includes('timan√†')) return LOGOS.timana;
                if (n.includes('gedeo') || n.includes('g√©d√©o')) return LOGOS.gedeo;
                return LOGOS.generic;
            }

            function App() {
                const [tab, setTab] = useState('shots');
                const [shots, setShots] = useState([]);
                const [bags, setBags] = useState([]);
                const [loading, setLoading] = useState(true);
                const [msg, setMsg] = useState(null);

                useEffect(() => { load(); }, []);

                async function load() {
                    try {
                        setLoading(true);
                        const { data: s } = await supabase.from('shots').select('*').order('created_at', { ascending: false });
                        const { data: b } = await supabase.from('bags').select('*').order('created_at', { ascending: false });
                        setShots(s || []);
                        setBags(b || []);
                    } catch (e) {
                        alert('Error: ' + e.message);
                    } finally {
                        setLoading(false);
                    }
                }

                async function addShot(shot) {
                    try {
                        const { data } = await supabase.from('shots').insert([shot]).select();
                        setShots([data[0], ...shots]);
                        setMsg({ t: 'success', m: '‚úÖ Shot enregistr√© !' });
                        setTab('shots');
                    } catch (e) {
                        setMsg({ t: 'error', m: '‚ùå ' + e.message });
                    }
                }

                async function delShot(id) {
                    if (!confirm('Supprimer ?')) return;
                    await supabase.from('shots').delete().eq('id', id);
                    setShots(shots.filter(s => s.id !== id));
                }

                async function addBag(bag) {
                    try {
                        const { data } = await supabase.from('bags').insert([bag]).select();
                        setBags([data[0], ...bags]);
                        setMsg({ t: 'success', m: '‚úÖ Paquet ajout√© !' });
                        setTab('bags');
                    } catch (e) {
                        setMsg({ t: 'error', m: '‚ùå ' + e.message });
                    }
                }

                async function updBag(id, upd) {
                    await supabase.from('bags').update(upd).eq('id', id);
                    setBags(bags.map(b => b.id === id ? { ...b, ...upd } : b));
                }

                async function delBag(id) {
                    if (!confirm('Supprimer ?')) return;
                    await supabase.from('bags').delete().eq('id', id);
                    setBags(bags.filter(b => b.id !== id));
                }

                async function imp(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = async (ev) => {
                        try {
                            const lines = ev.target.result.split('\n').filter(l => l.trim());
                            const data = [];
                            for (let i = 1; i < lines.length; i++) {
                                const v = lines[i].split(',');
                                if (v.length < 10) continue;
                                data.push({
                                    date: v[0].trim(),
                                    coffee: v[1].trim(),
                                    roaster: v[2].trim(),
                                    roast_date: v[3].trim(),
                                    age: parseInt(v[4]) || 0,
                                    dose: parseFloat(v[5]) || 18,
                                    output: parseFloat(v[6]) || 36,
                                    ratio: parseFloat(v[7]) || 2,
                                    grind: parseFloat(v[8]) || 7.5,
                                    time: parseInt(v[9]) || 0,
                                    preinfusion: parseInt(v[10]) || 0,
                                    wdt: v[11]?.trim() || 'non',
                                    channeling: v[12]?.trim() || 'non',
                                    flow: v[13]?.trim() || 'stable',
                                    taste: v[14]?.trim() || '',
                                    notes: v[15]?.trim() || ''
                                });
                            }
                            await supabase.from('shots').insert(data);
                            load();
                            setMsg({ t: 'success', m: `‚úÖ ${data.length} shots import√©s !` });
                        } catch (e) {
                            setMsg({ t: 'error', m: '‚ùå ' + e.message });
                        }
                    };
                    reader.readAsText(file);
                }

                function exp() {
                    const h = ['Date shot','Caf√©','Torr√©facteur','Date torr√©faction','√Çge (jours)','Dose (g)','Sortie (g)','Ratio','Mouture','Temps (s)','Pr√©infusion (s)','WDT','Channeling','D√©bit','Go√ªt','Notes'];
                    const rows = shots.map(s => [s.date,s.coffee,s.roaster,s.roast_date,s.age,s.dose,s.output,s.ratio,s.grind,s.time,s.preinfusion,s.wdt,s.channeling,s.flow,s.taste,s.notes].join(','));
                    const csv = [h.join(','), ...rows].join('\n');
                    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `espresso_${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();
                }

                if (loading) return React.createElement('div', { className: 'container' }, React.createElement('div', { className: 'loading' }, React.createElement('h1', null, '‚òï Chargement...')));

                return React.createElement('div', { className: 'container' },
                    React.createElement('h1', null, '‚òï Espresso Tracker'),
                    msg && React.createElement('div', { className: `alert alert-${msg.t}` }, msg.m),
                    React.createElement('div', { className: 'tabs' },
                        ['shots', '+ Shot', 'bags', '+ Paquet', 'stats', '‚öôÔ∏è'].map((name, i) => {
                            const id = ['shots', 'add-shot', 'bags', 'add-bag', 'stats', 'settings'][i];
                            return React.createElement('button', {
                                key: id,
                                className: `tab ${tab === id ? 'active' : ''}`,
                                onClick: () => setTab(id)
                            }, name);
                        })
                    ),
                    tab === 'shots' && React.createElement(Shots, { shots, del: delShot, logo: getLogo }),
                    tab === 'add-shot' && React.createElement(AddShot, { bags, add: addShot, logo: getLogo }),
                    tab === 'bags' && React.createElement(Bags, { bags, upd: updBag, del: delBag, logo: getLogo }),
                    tab === 'add-bag' && React.createElement(AddBag, { add: addBag, logo: getLogo }),
                    tab === 'stats' && React.createElement(Stats, { shots, bags }),
                    tab === 'settings' && React.createElement(Settings, { imp, exp, count: shots.length })
                );
            }

            function Shots({ shots, del, logo }) {
                if (!shots.length) return React.createElement('div', { className: 'card' }, React.createElement('div', { className: 'alert alert-info' }, 'Aucun shot. Importez vos donn√©es !'));
                return React.createElement('div', { className: 'shot-list' },
                    shots.map(s => React.createElement('div', { key: s.id, className: 'shot-card' },
                        React.createElement('div', { className: 'shot-header' },
                            React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '10px' } },
                                React.createElement('img', { src: logo(s.coffee), style: { width: '32px', height: '32px', borderRadius: '50%' } }),
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'shot-title' }, s.coffee),
                                    React.createElement('div', { className: 'shot-date' }, s.date)
                                )
                            ),
                            React.createElement('button', { className: 'btn btn-danger btn-small', onClick: () => del(s.id) }, '‚úï')
                        ),
                        React.createElement('div', { className: 'shot-details' },
                            React.createElement('div', { className: 'detail' }, React.createElement('strong', null, s.dose+'g'), ' ‚Üí ', React.createElement('strong', null, s.output+'g'), ` (1:${s.ratio.toFixed(1)})`),
                            React.createElement('div', { className: 'detail' }, 'Mouture: ', React.createElement('strong', null, s.grind)),
                            React.createElement('div', { className: 'detail' }, 'Temps: ', React.createElement('strong', null, s.time+'s')),
                            React.createElement('div', { className: 'detail' }, 'PI: ', React.createElement('strong', null, s.preinfusion+'s')),
                            React.createElement('div', { className: 'detail' }, '√Çge: ', React.createElement('strong', null, s.age+'j')),
                            React.createElement('div', { className: 'detail' }, 'WDT: ', React.createElement('strong', null, s.wdt)),
                            React.createElement('div', { className: 'detail' }, 'Channeling: ', React.createElement('strong', null, s.channeling)),
                            React.createElement('div', { className: 'detail' }, 'Go√ªt: ', React.createElement('strong', null, s.taste))
                        ),
                        s.notes && React.createElement('div', { style: { marginTop: '10px', fontSize: '14px', color: '#666', fontStyle: 'italic' } }, 'üìù ' + s.notes)
                    ))
                );
            }

            function AddShot({ bags, add, logo }) {
                const [d, setD] = useState({ coffee: 'G√©d√©o', roaster: "L'Arbre √† Caf√©", roast_date: '', dose: 18, output: 38, grind: 7.5, time: 30, preinfusion: 8, wdt: 'non', channeling: 'non', flow: 'stable', taste: '', notes: '' });
                const active = bags.filter(b => b.status === 'active');

                function submit(e) {
                    e.preventDefault();
                    const age = d.roast_date ? Math.floor((new Date() - new Date(d.roast_date.split('/').reverse().join('-'))) / 86400000) : 0;
                    add({
                        date: new Date().toLocaleString('fr-FR'),
                        coffee: d.coffee,
                        roaster: d.roaster,
                        roast_date: d.roast_date,
                        age,
                        dose: parseFloat(d.dose),
                        output: parseFloat(d.output),
                        ratio: parseFloat((d.output / d.dose).toFixed(2)),
                        grind: parseFloat(d.grind),
                        time: parseInt(d.time),
                        preinfusion: parseInt(d.preinfusion),
                        wdt: d.wdt,
                        channeling: d.channeling,
                        flow: d.flow,
                        taste: d.taste,
                        notes: d.notes
                    });
                }

                return React.createElement('div', { className: 'card' },
                    React.createElement('h2', null, 'Nouveau Shot'),
                    active.length > 0 && React.createElement('div', { className: 'alert alert-info', style: { marginBottom: '20px' } }, 'üí° Paquets actifs : ', React.createElement('strong', null, active.map(b => b.name).join(', '))),
                    React.createElement('form', { onSubmit: submit },
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', null, 'Caf√© *'),
                            React.createElement('div', { style: { display: 'flex', gap: '10px', marginBottom: '10px', flexWrap: 'wrap' } },
                                [['G√©d√©o', 'gedeo'], ['Timan√†', 'timana'], ['Autre', 'generic']].map(([name, key]) =>
                                    React.createElement('button', {
                                        key,
                                        type: 'button',
                                        onClick: () => setD({...d, coffee: name === 'Autre' ? '' : name}),
                                        style: { padding: '8px 12px', border: d.coffee === name || (!d.coffee && name === 'Autre') ? '3px solid #6f4e37' : '2px solid #e0e0e0', borderRadius: '8px', background: 'white', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px' }
                                    },
                                        React.createElement('img', { src: LOGOS[key], style: { width: '24px', height: '24px', borderRadius: '50%' } }),
                                        React.createElement('span', null, name)
                                    )
                                )
                            ),
                            React.createElement('input', { type: 'text', value: d.coffee, onChange: e => setD({...d, coffee: e.target.value}), placeholder: 'Nom du caf√©', required: true })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', null, 'Torr√©facteur'),
                            React.createElement('input', { type: 'text', value: d.roaster, onChange: e => setD({...d, roaster: e.target.value}) })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', null, 'Date torr√©faction (JJ/MM/AAAA)'),
                            React.createElement('input', { type: 'text', placeholder: '31/12/2025', value: d.roast_date, onChange: e => setD({...d, roast_date: e.target.value}) })
                        ),
                        React.createElement('div', { className: 'two-col' },
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', null, 'Dose (g) *'),
                                React.createElement('input', { type: 'number', step: '0.1', value: d.dose, onChange: e => setD({...d, dose: e.target.value}), required: true })
                            ),
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', null, 'Sortie (g) *'),
                                React.createElement('input', { type: 'number', step: '0.1', value: d.output, onChange: e => setD({...d, output: e.target.value}), required: true })
                            )
                        ),
                        React.createElement('div', { className: 'two-col' },
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', null, 'Mouture *'),
                                React.createElement('input', { type: 'number', step: '0.1', value: d.grind, onChange: e => setD({...d, grind: e.target.value}), required: true })
                            ),
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', null, 'Temps (s) *'),
                                React.createElement('input', { type: 'number', value: d.time, onChange: e => setD({...d, time: e.target.value}), required: true })
                            )
                        ),
                        React.createElement('div', { className: 'two-col' },
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', null, 'Pr√©infusion (s)'),
                                React.createElement('input', { type: 'number', value: d.preinfusion, onChange: e => setD({...d, preinfusion: e.target.value}) })
                            ),
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', null, 'WDT'),
                                React.createElement('select', { value: d.wdt, onChange: e => setD({...d, wdt: e.target.value}) },
                                    ['non', 'l√©ger', 'normal', 'profond'].map(o => React.createElement('option', { key: o, value: o }, o.charAt(0).toUpperCase() + o.slice(1)))
                                )
                            )
                        ),
                        React.createElement('div', { className: 'two-col' },
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', null, 'Channeling'),
                                React.createElement('select', { value: d.channeling, onChange: e => setD({...d, channeling: e.target.value}) },
                                    ['non', 'oui'].map(o => React.createElement('option', { key: o, value: o }, o.charAt(0).toUpperCase() + o.slice(1)))
                                )
                            ),
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', null, 'D√©bit'),
                                React.createElement('select', { value: d.flow, onChange: e => setD({...d, flow: e.target.value}) },
                                    ['rapide', 'stable', 'lent'].map(o => React.createElement('option', { key: o, value: o }, o.charAt(0).toUpperCase() + o.slice(1)))
                                )
                            )
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', null, 'Go√ªt'),
                            React.createElement('input', { type: 'text', placeholder: 'tr√®s bon, bon, acide...', value: d.taste, onChange: e => setD({...d, taste: e.target.value}) })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', null, 'Notes'),
                            React.createElement('textarea', { rows: 3, placeholder: 'Observations...', value: d.notes, onChange: e => setD({...d, notes: e.target.value}) })
                        ),
                        React.createElement('button', { type: 'submit', className: 'btn btn-primary', style: { width: '100%' } }, 'Enregistrer le Shot')
                    )
                );
            }

            function Bags({ bags, upd, del, logo }) {
                if (!bags.length) return React.createElement('div', { className: 'card' }, React.createElement('div', { className: 'alert alert-info' }, 'Aucun paquet.'));
                
                function age(date) {
                    if (!date) return 0;
                    const [d, m, y] = date.split('/');
                    return Math.floor((new Date() - new Date(y, m - 1, d)) / 86400000);
                }

                return React.createElement('div', { className: 'bag-list' },
                    bags.map(b => React.createElement('div', { key: b.id, className: 'bag-card' },
                        React.createElement('div', { className: 'bag-header' },
                            React.createElement('div', { style: { display: 'flex', alignItems: 'flex-start', gap: '12px' } },
                                React.createElement('img', { src: logo(b.name), style: { width: '48px', height: '48px', borderRadius: '50%', marginTop: '4px' } }),
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'bag-title' }, b.name),
                                    React.createElement('div', { style: { fontSize: '14px', color: '#666', marginTop: '8px' } }, `${b.roaster} ‚Ä¢ Torr√©fi√© le ${b.roast_date}`),
                                    React.createElement('div', { style: { fontSize: '14px', color: '#666', marginTop: '8px' } }, `√Çge: ${age(b.roast_date)} jours ‚Ä¢ ${b.weight}g`),
                                    React.createElement('span', { className: `bag-status ${b.status}` }, b.status === 'active' ? '‚úì Actif' : '‚óã Termin√©')
                                )
                            ),
                            React.createElement('div', { style: { display: 'flex', gap: '8px' } },
                                React.createElement('button', { className: 'btn btn-secondary btn-small', onClick: () => upd(b.id, { status: b.status === 'active' ? 'finished' : 'active' }) }, b.status === 'active' ? 'Terminer' : 'R√©activer'),
                                React.createElement('button', { className: 'btn btn-danger btn-small', onClick: () => del(b.id) }, '‚úï')
                            )
                        ),
                        b.notes && React.createElement('div', { style: { marginTop: '10px', fontSize: '14px', color: '#666', fontStyle: 'italic' } }, 'üìù ' + b.notes)
                    ))
                );
            }

            function AddBag({ add, logo }) {
                const [d, setD] = useState({ name: '', roaster: "L'Arbre √† Caf√©", roast_date: '', weight: 250, notes: '', status: 'active' });

                function submit(e) {
                    e.preventDefault();
                    add(d);
                    setD({ name: '', roaster: "L'Arbre √† Caf√©", roast_date: '', weight: 250, notes: '', status: 'active' });
                }

                return React.createElement('div', { className: 'card' },
                    React.createElement('h2', null, 'Nouveau Paquet'),
                    React.createElement('form', { onSubmit: submit },
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', null, 'Nom du caf√© *'),
                            React.createElement('div', { style: { display: 'flex', gap: '10px', marginBottom: '10px', flexWrap: 'wrap' } },
                                [['G√©d√©o', 'gedeo'], ['Timan√†', 'timana']].map(([name, key]) =>
                                    React.createElement('button', {
                                        key,
                                        type: 'button',
                                        onClick: () => setD({...d, name}),
                                        style: { padding: '8px 12px', border: d.name === name ? '3px solid #6f4e37' : '2px solid #e0e0e0', borderRadius: '8px', background: 'white', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px' }
                                    },
                                        React.createElement('img', { src: LOGOS[key], style: { width: '24px', height: '24px', borderRadius: '50%' } }),
                                        React.createElement('span', null, name)
                                    )
                                )
                            ),
                            React.createElement('input', { type: 'text', placeholder: 'G√©d√©o, Finca...', value: d.name, onChange: e => setD({...d, name: e.target.value}), required: true })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', null, 'Torr√©facteur'),
                            React.createElement('input', { type: 'text', value: d.roaster, onChange: e => setD({...d, roaster: e.target.value}) })
                        ),
                        React.createElement('div', { className: 'two-col' },
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', null, 'Date torr√©faction (JJ/MM/AAAA) *'),
                                React.createElement('input', { type: 'text', placeholder: '31/12/2025', value: d.roast_date, onChange: e => setD({...d, roast_date: e.target.value}), required: true })
                            ),
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', null, 'Poids (g)'),
                                React.createElement('input', { type: 'number', value: d.weight, onChange: e => setD({...d, weight: e.target.value}) })
                            )
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', null, 'Notes'),
                            React.createElement('textarea', { rows: 3, placeholder: 'Profil aromatique...', value: d.notes, onChange: e => setD({...d, notes: e.target.value}) })
                        ),
                        React.createElement('button', { type: 'submit', className: 'btn btn-primary', style: { width: '100%' } }, 'Ajouter le Paquet')
                    )
                );
            }

            function Stats({ shots, bags }) {
                const chartRef = useRef(null);
                const [chart, setChart] = useState(null);

                useEffect(() => {
                    if (shots.length && chartRef.current) {
                        if (chart) chart.destroy();
                        const ctx = chartRef.current.getContext('2d');
                        const sorted = [...shots].sort((a, b) => a.age - b.age);
                        const c = new Chart(ctx, {
                            type: 'scatter',
                            data: {
                                datasets: [{
                                    label: 'Mouture vs √Çge',
                                    data: sorted.map(s => ({ x: s.age, y: s.grind })),
                                    backgroundColor: 'rgba(111, 78, 55, 0.6)',
                                    borderColor: 'rgba(111, 78, 55, 1)',
                                    borderWidth: 2,
                                    pointRadius: 6
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    x: { title: { display: true, text: '√Çge du caf√© (jours)' } },
                                    y: { title: { display: true, text: 'Mouture' } }
                                }
                            }
                        });
                        setChart(c);
                    }
                    return () => { if (chart) chart.destroy(); };
                }, [shots]);

                if (!shots.length) return React.createElement('div', { className: 'card' }, React.createElement('div', { className: 'alert alert-info' }, 'Pas de stats.'));

                const avg = (arr, key) => (arr.reduce((s, x) => s + x[key], 0) / arr.length).toFixed(1);

                return React.createElement('div', null,
                    React.createElement('div', { className: 'stats-grid' },
                        [
                            [shots.length, 'Shots'],
                            [bags.length, 'Paquets'],
                            [avg(shots, 'grind'), 'Mouture moy.'],
                            [Math.round(avg(shots, 'time')) + 's', 'Temps moy.']
                        ].map(([val, label], i) =>
                            React.createElement('div', { key: i, className: 'stat-card' },
                                React.createElement('div', { className: 'stat-value' }, val),
                                React.createElement('div', { className: 'stat-label' }, label)
                            )
                        )
                    ),
                    React.createElement('div', { className: 'card' },
                        React.createElement('h3', null, '√âvolution Mouture vs √Çge'),
                        React.createElement('div', { className: 'chart-container' },
                            React.createElement('canvas', { ref: chartRef })
                        )
                    )
                );
            }

            function Settings({ imp, exp, count }) {
                return React.createElement('div', { className: 'card' },
                    React.createElement('h2', null, 'Param√®tres'),
                    React.createElement('div', { className: 'alert alert-success' }, '‚úÖ Synchronis√© via Supabase'),
                    React.createElement('div', { style: { marginTop: '20px' } },
                        React.createElement('h3', null, 'Importer CSV'),
                        React.createElement('p', { style: { color: '#666', fontSize: '14px', marginBottom: '15px' } }, 'Importez vos donn√©es.'),
                        React.createElement('div', { className: 'file-input-wrapper' },
                            React.createElement('button', { className: 'btn btn-secondary' }, 'üìÅ Fichier CSV'),
                            React.createElement('input', { type: 'file', accept: '.csv', onChange: imp })
                        )
                    ),
                    React.createElement('div', { style: { marginTop: '20px', paddingTop: '20px', borderTop: '2px solid #e0e0e0' } },
                        React.createElement('h3', null, 'Exporter'),
                        React.createElement('p', { style: { color: '#666', fontSize: '14px', marginBottom: '15px' } }, `${count} shots`),
                        React.createElement('button', { className: 'btn btn-primary', onClick: exp, disabled: !count }, 'üì• T√©l√©charger CSV')
                    )
                );
            }

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(React.createElement(App));
        });
    </script>
</body>
</html>
